# generated by `./generate_action_config.py melodic`
# jsk_travis
on: [push, pull_request]

jobs:
  melodic:
    runs-on: ubuntu-latest
    name: melodic

    container: jskrobotics/ros-ubuntu:18.04

    steps:
      - name: Install latest git ( use sudo for ros-ubuntu, remove sudo for ubuntu container), checkout@v2 uses REST API for git<2.18, which removes .git folder and does not checkout .travis submodules
        run: sudo apt-get update && sudo apt-get install -y software-properties-common && sudo apt-get update && sudo add-apt-repository -y ppa:git-core/ppa && sudo apt-get update && sudo apt-get install -y git
      - name: Before Checkout # need for actions/checkout with ros-ubuntu container
        run: sudo chown -R user:jenkins $RUNNER_WORKSPACE $HOME
      - name: Checkout
        uses: actions/checkout@v2
      - name: Run jsk_travis
        uses: jsk-ros-pkg/jsk_travis@master
        with:
          ROS_DISTRO : melodic
          USE_DEB: false
          NOT_TEST_INSTALL: true
          BUILD_PKGS: 'choreonoid hrpsys_choreonoid_tutorials jvrc_models hrpsys_choreonoid hrpsys_ros_bridge_jvrc' # avoid compiling unused packages
          BEFORE_SCRIPT: './choreonoid/misc/script/install-requisites-ubuntu-18.04.sh ; patch -p1 -d choreonoid < rtmros_choreonoid/choreonoid.patch' # follow the installation instructions in the readme
          ROSDEP_ADDITIONAL_OPTIONS: '-n -q -r --ignore-src --skip-keys libpng12-dev --skip-keys leap_motion' # libpng12-dev(depend of choreonoid) and leap_motion(depend of hironx_tutorials) are not released on melodic
          CATKIN_TOOLS_BUILD_OPTIONS: '-iv --summarize --no-status --make-args -Wno-deprecated --' # choreonoid, hrpsys and openhrp3 output too many warnings.
          CATKIN_TOOLS_CONFIG_OPTIONS: '--blacklist jsk_footstep_controller jsk_footstep_planner' # avoid building run_depend to reduce building time
